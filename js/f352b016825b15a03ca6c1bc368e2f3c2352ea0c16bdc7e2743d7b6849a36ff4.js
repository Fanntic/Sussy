!function(){"use strict";var e=Roblox,t=CoreRobloxUtilities,n="ItemPurchaseAjaxData",r="/games/",a="/v1/products/{productId}/purchase",o="Game Pass",i="Bundle",l="Package",s="/v1/game-passes",c="/v1/bundles/thumbnails",u="/v1/assets",d={size:"150x150",format:"Png",isCircular:!1},p="Action.BackToShop",v="Action.BuyRobuxAndItem",y="Action.Cancel",h="Action.EquipMyAvatar",E="Action.GoToRobuxStore",m="Heading.InsufficientRobux",f="Message.InsufficientRobux",b="Message.InsufficientRobuxExceedLargestPackage",w="Heading.PurchaseSucceeded",_="Message.PurchaseSucceeded",S="Message.PurchaseSucceededRobuxBalance",P="Label.PurchasingTheItem",U="Label.WaitingForRobux",T="Heading.ErrorOccured",g="Message.PurchaseErrorOccured",A="Action.Ok",I="Action.OK",x="Action.Cancel",C="Heading.ScaryModalTitle",N="Description.ScaryModalBodyNew",R="Description.ScaryModalBody13To17",M="Description.ScaryModalThreshold1Body",L="Description.ScaryModalThreshold2Body",O="U13PaymentModal",F="ParentalConsentWarningPaymentModal13To17",G="U13MonthlyThreshold1Modal",D="RequireEmailVerification",B="U13MonthlyThreshold2Modal",k="NoAction",W="ItemPurchaseUpsellEvent",V={COOKIE_PARSE_FAILED:"COOKIE_PARSE_FAILED",PRODUCT_INFO_REQUEST_FAILED:"PRODUCT_INFO_REQUEST_FAILED",PRODUCT_INFO_EMPTY:"PRODUCT_INFO_EMPTY",PRODUCT_ID_NOT_EXIST:"PRODUCT_ID_NOT_EXIST",UPSELL_FAILED:"UPSELL_FAILED"},H="NoTypeParsedYet",X="UnknownErrorNoAsset",j="UpsellShown",Y="UpsellCancelled",q="UpsellCancelledFromU13Modal",K="UpsellContinued",z="UpsellThumbnailProcessFailed",Q="UpsellExceedLargestEntryPoint",J="UpsellExceedLargestShown",Z="UpsellExceedLargestCancelled",$="UpsellExceedLargestGoToRobuxStoreClicked",ee="UpsellExceedLargestModalExpTrue",te="UpsellExceedLargestModalExpTrue",ne="UpsellExceedLargestModalExpError",re="UpsellExceedLargestMetadataError",ae="UpsellExceedLargestNoThumbnailImage",oe="UpsellFromGamesPage",ie="UpsellFailed",le="UpsellFailedDueToNoAvailablePackage",se="UpsellFailedDueToFailedPackageRequest",ce="AutoPurchaseEntryPoint",ue="AutoPurchaseStarted",de="AutoPurchaseSucceed",pe="AutoPurchaseSucceedClose",ve="AutoPurchaseSucceedBackToShop",ye="AutoPurchaseSucceedEquipMyAvatar",he="AutoPurchaseFailed",Ee="AutoPurchaseErrorFromPurchaseApi",me="AutoPurchaseFailedDueToStillLowBalance",fe="AutoPurchasePotentialHackingActionSpotted",be="AutoPurchasePotentialHackingActionSpotted2",we="AutoPurchasePotentialHackingActionSpotted3",_e="AutoPurchasePotentialHackingActionSpotted4",Se="ShowU13PaymentModal",Pe="ShowU13MonthlyThreshold1Modal",Ue="ShowU13MonthlyThreshold2Modal",Te="ShowParentalConsentWarningPaymentModal13To17Modal",ge="ConfirmU13PaymentModal",Ae="ConfirmU13MonthlyThreshold1Modal",Ie="ConfirmU13MonthlyThreshold2Modal",xe="ConfirmParentalConsentWarningPaymentModal13To17Modal",Ce="U13PaymentModalEmailVerificationTriggered",Ne="U13PaymentModalFailedToShow",Re="U13PaymentModalNoAction";function Me(t){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var n,r;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(a){switch(a.label){case 0:if(!t)return[2,!1];try{n=JSON.parse(t)}catch(a){return[2,!1]}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.ExperimentationService.getAllValuesForLayer(n.LayerName)];case 2:return[2,null!=(r=(r=a.sent())[n.Parameter])&&r];case 3:return a.sent(),[2,!1];case 4:return[2]}}))}))}var Le=CoreUtilities;function Oe(t,n){return void 0===n&&(n=!0),n?"<span class='icon-robux-16x16'></span><span class='text-robux'>"+e.NumberFormatting.commas(t)+"</span>":"<span class='icon-robux-gray-16x16'></span><span class='text'>"+e.NumberFormatting.commas(t)+"</span>"}function Fe(){var e;t.upsellUtil.expireUpsellCookie(),window.history&&((e=new URL(window.location.href)).searchParams.delete(t.upsellUtil.constants.UPSELL_QUERY_PARAM_KEY),e=e.href,window.history.pushState({path:e},"",e))}var Ge=window.EventTracker?EventTracker:{fireEvent:console.log,start:console.log,endSuccess:console.log,endCancel:console.log,endFailure:console.log};function De(e){(0,Ge.fireEvent)("WebCatalog"+e)}function Be(e,t){var n;t===i||t===l?(n=e,(0,Ge.fireEvent)("WebBundle"+n)):t===o?(n=e,(0,Ge.fireEvent)("WebGamePass"+n)):De(t?e:X)}function ke(t,n,r,a,o){var i=a.getTranslationResource("Feature.Premium"),l=a.getTranslationResource("CommonUI.Controls"),s=(a={lineBreak:s="<br /><br />",linebreak:s},"");n===O?s=i.get(N,a):n===F?s=i.get(R,{}):n===G?s=i.get(M,a):n===B&&(s=i.get(L,a)),e.Dialog.open({titleText:i.get(C,{}),bodyContent:'<div><span class="text-description">'+s+'</span></div><div class="text-center"><div class="icon-warning"></div></div>',declineText:l.get(x,{}),acceptText:l.get(I,{}),onAccept:function(){return function(t,n){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:a={acknowledgement:"Confirmed"+t},r={url:e.EnvironmentUrls.apiGatewayUrl+"/purchase-warning/v1/purchase-warnings/acknowledge",withCredentials:!0,timeout:5e3},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Le.httpService.post(r,a)];case 2:return o.sent(),n(),[2,Promise.resolve()];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n,r).then((function(){Be(n===O?ge:n===G?Ae:n===B?Ie:xe,null==o?void 0:o.assetType)})).catch((function(){r()})),!1},onDecline:function(){return Be(q,null==o?void 0:o.assetType),Fe(),!1},onCancel:function(){return Be(q,null==o?void 0:o.assetType),Fe(),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}function We(e){t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN,e)}function Ve(n,r,a,o,i){var l;return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var s;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(c){switch(c.label){case 0:if(!r)return a(),[2,Promise.resolve()];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,function(t){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var n,r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:r=!e.CurrentUser.isPremiumUser,n={productId:t,is13To17ScaryModalEnabled:r},r={url:e.EnvironmentUrls.apiGatewayUrl+"/purchase-warning/v1/purchase-warnings",withCredentials:!0,timeout:5e3},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Le.httpService.get(r,n)];case 2:return 200===(a=o.sent()).status&&a.data.action?[2,Promise.resolve(a.data.action)]:[2,Promise.resolve(k)];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n.roblox_product_id)];case 2:return(s=c.sent())===O||s===F||s===G||s===B?(s===O?(We(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_PAYMENT_MODAL),Be(Se,null==i?void 0:i.assetType)):s===G?(We(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_MONTHLY_THRESHOLD_1_MODAL),Be(Pe,null==i?void 0:i.assetType)):s===B?(We(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_MONTHLY_THRESHOLD_2_MODAL),Be(Ue,null==i?void 0:i.assetType)):(We(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.PAYMENT_MODAL_13_TO_17),Be(Te,null==i?void 0:i.assetType)),ke(0,s,a,o,i)):s===D?(Be(Ce,null==i?void 0:i.assetType),null!==(l=e.EmailVerificationService.handleUserEmailVerificationRequiredByPurchaseWarning())&&void 0!==l&&l.then((function(e){We(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.REQUIRE_EMAIL_VERIFICATION),null!=e&&e.emailAddress&&null!=e&&e.verified&&a()}))):(Be(Re,null==i?void 0:i.assetType),a()),[2,Promise.resolve()];case 3:return s=c.sent(),[2,Promise.reject(s)];case 4:return[2]}}))}))}function He(n,r,a){var o=function(n){var r=t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname);t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0;var a=null;if(Array.isArray(r)&&0<r.length&&(a=r[0]),!a)return"";if(!n||Object.keys(n).length<4)return"";var o=Le.uuidService.generateRandomUuid();r=n.expectedCurrency+","+n.expectedPrice+","+n.expectedSellerId+","+(null!==(r=n.userassetId)&&void 0!==r?r:""),n=""+(n.productId||""),r=o+","+a+","+e.CurrentUser.userId+","+r+","+n;return(n=new Date).setHours(n.getHours()+1),n=[t.upsellUtil.constants.UPSELL_COOKIE_KEY,"=",encodeURIComponent(r),"; expires="+n.toUTCString(),"; path=/","; domain=.",e.EnvironmentUrls.domain,";"],document.cookie=n.join(""),o}(a);Be(K,null==a?void 0:a.assetType),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.GO_TO_ROBUX_PURCHASE_PAGE),window.location.href=e.Endpoints.getAbsoluteUrl("/upgrades/paymentmethods")+"?ap="+n.roblox_product_id+"&UpsellUuid="+o}function Xe(){var e=this;this.overlayDiv=null,this.contentDiv=null,this.loadingMessageSpan=null,this.spinnerSpan=null,this.loadingOverlayElementId="loading-overlay",this.show=function(t){var n=e.getOrCreateOverlayDiv();n=e.getOrCreateContentDiv(n);return e.getOrCreateSpinnerSpan(n),e.updateOrCreateMessage(t),e},this.hide=function(){var t;null!==(t=null===(t=e.spinnerSpan)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.spinnerSpan),null!==(t=null===(t=e.loadingMessageSpan)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.loadingMessageSpan),null!==(t=null===(t=e.contentDiv)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.contentDiv),null!==(t=null===(t=e.overlayDiv)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.overlayDiv),e.overlayDiv=null,e.contentDiv=null,e.spinnerSpan=null,e.loadingMessageSpan=null},this.updateMessage=function(t){e._loadingMessage=t,e.updateOrCreateMessage(t)},this.updateOrCreateMessage=function(t){var n;if(e.overlayDiv)return t?void(e.loadingMessageSpan?e.loadingMessageSpan.innerText=t:((n=document.createElement("span")).innerText=t,n.classList.add("loading-message"),e.getOrCreateContentDiv(e.overlayDiv).appendChild(n),e.loadingMessageSpan=n)):(null!==(n=null===(n=e.loadingMessageSpan)||void 0===n?void 0:n.parentNode)&&void 0!==n&&n.removeChild(e.loadingMessageSpan),void(e.loadingMessageSpan=null))},this.getOrCreateContentDiv=function(t){if(e.contentDiv)return e.contentDiv;var n=document.createElement("div");return n.classList.add("loading-overlay-content"),e.contentDiv=n,t.appendChild(n),n},this.getOrCreateOverlayDiv=function(){if(e.overlayDiv)return e.overlayDiv;var t=document.getElementById(e.loadingOverlayElementId);return t?e.overlayDiv=t:(t=document.createElement("div"),(e.overlayDiv=t).id=e.loadingOverlayElementId,t.classList.add("loading-overlay"),document.body.appendChild(t),t)},this.getOrCreateSpinnerSpan=function(t){if(e.spinnerSpan)return e.spinnerSpan;var n=document.createElement("span");return n.classList.add("spinner","spinner-default"),t.appendChild(n),e.spinnerSpan=n}}var je=(Object.defineProperty(Xe.prototype,"loadingMessage",{get:function(){return this._loadingMessage},enumerable:!1,configurable:!0}),Xe);function Ye(n){t.upsellUtil.expireUpsellCookie(),window.location.href=e.Endpoints.getAbsoluteUrl(n)}function qe(e){var t;return"true"===(null===(t=null==e?void 0:e.gamePassUpsellExperimentBypass)||void 0===t?void 0:t.toLowerCase())||"true"===(null===(e=null==e?void 0:e.bundleItemUpsellExperimentBypass)||void 0===e?void 0:e.toLowerCase())}function Ke(e){return(null==e?void 0:e.catalogUpsellExperimentSerializedMetadata)||(null==e?void 0:e.gamePassUpsellExperimentSerializedMetadata)||(null==e?void 0:e.bundleItemUpsellExperimentSerializedMetadata)}var ze=function(e){var t;return"true"===(null===(t=null==e?void 0:e.isCatalogUpsellExperimentEnabled)||void 0===t?void 0:t.toLowerCase())||"true"===(null===(t=null==e?void 0:e.isGamePassUpsellExperimentEnabled)||void 0===t?void 0:t.toLowerCase())||"true"===(null===(e=null==e?void 0:e.isBundleItemUpsellExperimentEnabled)||void 0===e?void 0:e.toLowerCase())},Qe=function(e){return!(null==e||!e.catalogUpsellExperimentSerializedMetadata)||!(null==e||!e.gamePassUpsellExperimentSerializedMetadata)||!(null==e||!e.bundleItemUpsellExperimentSerializedMetadata)},Je=function(){return(Je=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function Ze(t,n){try{e.EventStream.SendEventWithTarget(W,t,n,e.EventStream.TargetTypes.WWW)}catch(t){}}var $e=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},et=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function tt(e){Fe(),Ye(e)}function nt(t,n){return $e(this,void 0,Promise,(function(){var r;return et(this,(function(a){switch(a.label){case 0:if(!n)return[2,Promise.reject()];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var n,r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:n={productId:t},r={url:e.EnvironmentUrls.economyApi+"/v1/products/{productId}",withCredentials:!0},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Le.httpService.get(r,n)];case 2:return 200!==(a=o.sent()).status||"Success"!==a.data.reason?[2,Promise.reject()]:[2,Promise.resolve(a.data)];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n)];case 2:return(r=a.sent())&&0!==Object.keys(r).length?[2,r]:(Be(we,H),Ze(V.PRODUCT_INFO_EMPTY,{itemPath:t,productId:n}),[2,Promise.reject()]);case 3:return r=a.sent(),Be(_e,H),Ze(V.PRODUCT_INFO_REQUEST_FAILED,{itemPath:t,productId:n,error:r}),[2,Promise.reject(r)];case 4:return[2]}}))}))}function rt(n,r,a){return $e(this,void 0,Promise,(function(){var l,p,v,y;return et(this,(function(h){switch(h.label){case 0:(y=t.upsellUtil.parseUpsellCookie())&&0!==Object.keys(y).length&&(!y.targetItemUrl||n.startsWith(y.targetItemUrl))||(Be(be,H),Ze(V.COOKIE_PARSE_FAILED,{itemPath:n,upsellCookieData:y}),tt(n)),(l=r)&&ze(l)&&Qe(l)||tt(n),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,nt(n,y.productId)];case 2:return p=h.sent(),[3,4];case 3:return v=h.sent(),Ze(V.PRODUCT_ID_NOT_EXIST,{itemPath:n,upsellCookieData:y,error:v}),tt(n),[2,Promise.reject()];case 4:return[4,function(t,n){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(l){switch(l.label){case 0:a=n===o?(r=s,{gamePassIds:t}):n===i?(r=c,{bundleIds:t}):(r=u,{assetIds:t}),a=Je(Je({},a),d),r={url:""+e.EnvironmentUrls.thumbnailsApi+r,withCredentials:!0},l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Le.httpService.get(r,a)];case 2:return 200===(a=l.sent()).status&&a.data.data&&0!==a.data.data.length?[2,Promise.resolve(a.data.data[0].imageUrl)]:[2,Promise.resolve(null)];case 3:return l.sent(),[2,Promise.resolve(null)];case 4:return[2]}}))}))}(p.assetId,p.assetType)];case 5:return v=h.sent(),l.imageurl=v||l.imageurl,y={expectedPrice:y.expectedPrice||"0",expectedCurrency:y.expectedCurrency||"1",expectedSellerId:y.expectedSellerId||"",itemId:p.assetId||(null==a?void 0:a.itemId),itemName:p.assetName||(null==a?void 0:a.itemName),assetType:p.assetType||(null==a?void 0:a.assetType),assetGranted:null==a?void 0:a.assetGranted,assetTypeDisplayName:p.assetTypeDisplayName||(null==a?void 0:a.assetTypeDisplayName),assetTypeId:null==a?void 0:a.assetTypeId,productId:p.productId||y.productId||(null==a?void 0:a.productId),itemType:p.assetType||(null==a?void 0:a.itemType),currentTime:null==a?void 0:a.currentTime,isPurchaseEnabled:null==a?void 0:a.isPurchaseEnabled,placeproductpromotionId:null==a?void 0:a.placeproductpromotionId,userassetId:y.userAssetId||(null==a?void 0:a.userassetId)},[2,[l,y]]}}))}))}function at(n,a,i,l){var s="<span>"+i.get(S,{userRobuxBalance:Oe(a)})+"</span>";a="<div class='item-content'>\n        <div class='item-card-container item-preview'>\n          <div class='item-card-thumb'>\n            <img alt='item preview' src='"+n.itemThumbnailUrl+"'/>\n          </div>\n        </div>\n        <div class='text-center'>\n          "+i.get(_,{assetName:n.assetName})+"\n          "+s+"\n        </div>\n      </div>",s=n.assetType!==o?i.get(h,{}):i.get(A,{});e.Dialog.open({titleText:i.get(w,{}),bodyContent:a,declineText:i.get(p,{}),acceptText:s,acceptColor:"btn-primary-md",onAccept:function(){var a;return t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.OK),Be(ye,n.assetType),n.assetType!==o?void 0!==(a=e.Endpoints.getAbsoluteUrl("/my/avatar"))&&""!==a&&(t.upsellUtil.expireUpsellCookie(),window.location.href=a):n.itemPath.startsWith(r)?Ye(n.itemPath+"?#!/store"):Ye(n.itemPath),!1},onDecline:function(){return l.show(),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),Be(ve,n.assetType),Ye(n.itemPath),!1},onCancel:function(){return l.show(),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),Be(pe,n.assetType),Ye(n.itemPath),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,showDecline:n.assetType!==o,dismissable:!1,xToCancel:!0})}function ot(t,n){e.Dialog.open({titleText:n.get(T,{}),bodyContent:n.get(g,{}),imageUrl:t.alertImageUrl,acceptText:n.get(A,{}),acceptColor:"btn-secondary-md",declineColor:"btn-none",dismissable:!0,allowHtmlContentInBody:!0})}var it=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},lt=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function st(t,n,r,a){return it(this,void 0,Promise,(function(){var o,i,l,s,c,u;return lt(this,(function(d){switch(d.label){case 0:o={url:t,withCredentials:!0,retryable:!1,noCache:!0,noPragma:!0},d.label=1;case 1:return d.trys.push([1,3,,4]),i={expectedCurrency:n.expectedCurrency,expectedPrice:n.expectedPrice,expectedSellerId:n.expectedSellerId,expectedPromoId:n.expectedPromoId,userAssetId:n.userAssetId},[4,Le.httpService.post(o,i)];case 2:return 500===(i=(i=d.sent()).data).statusCode?(Be(Ee,n.assetType),void 0===i.showDivID&&(i.showDivID=i.showDivId),void 0===i.AssetID&&(i.AssetID=i.assetId),r.hide(),(0,e.ItemPurchase)().openErrorView(i),Fe(),[2,Promise.resolve()]):(n.isLibrary&&e.EventStream&&e.UrlParser&&(p=i.assetId,v=e.CurrentUser&&e.CurrentUser.userId,y=e.UrlParser.getParametersAsObject(),l={assetId:p,category:y.Category,creatorId:y.CreatorId,genre:y.GenreCsv,page:y.Page,position:y.Position,searchKeyword:y.SearchKeyword,sortAggregation:y.SortAggregation,sortType:y.SortType,userId:v,searchId:y.SearchId},e.EventStream.SendEventWithTarget("LibraryAssetAcquired","Marketplace",l,e.EventStream.TargetTypes.WWW)),Be(de,n.assetType),r.hide(),s=n.userBalance-n.expectedPrice,at(n,s,a,r),[2,Promise.resolve()]);case 3:if(l=d.sent(),r.hide(),Be(he,n.assetType),"object"!=typeof(s=l)||!("responseText"in s.request))return[2,Promise.reject(s.request)];if("Bad Request"===(c=s.request).responseText)ot(n,a);else try{u=JSON.parse(c.responseText),(0,e.ItemPurchase)().openErrorView(u),Fe()}catch(d){return[2,Promise.reject(d)]}return[2,Promise.reject(l)];case 4:return[2]}var p,v,y}))}))}function ct(t,n,r,s){var c;return void 0===n&&(n=void 0),it(this,void 0,Promise,(function(){var u,d,p,v;return lt(this,(function(y){switch(y.label){case 0:if(null!==(c=t.itemContainerElemClassList)&&void 0!==c&&c.contains("btn-disabled-primary"))return[2,Promise.resolve()];if(u=""+e.EnvironmentUrls.passProductPurchasingApi+a.replace("{productId}",t.productId),d=""+e.EnvironmentUrls.bundlesProductPurchasingApi+a.replace("{productId}",t.productId),p=""+e.EnvironmentUrls.economyApi+"/v1/purchases/products/{productId}".replace("{productId}",t.productId),n)return[2,n({productId:t.productId,expectedPrice:t.expectedPrice,expectedCurrency:t.expectedCurrency,expectedPromoId:null===(c=t.expectedPromoId)||void 0===c?void 0:c.toString(),expectedSellerId:t.expectedSellerId,userAssetId:null===(c=t.userAssetId)||void 0===c?void 0:c.toString()})];Be(ue,t.assetType),y.label=1;case 1:return y.trys.push([1,3,,4]),v={url:e.EnvironmentUrls.economyApi+"/v2/metadata/nextgen-purchase-status",withCredentials:!0},[4,Le.httpService.get(v)];case 2:if(200===(v=y.sent()).status){if(v.data.isNextGenPassProductPurchasingEnabled&&t.assetType===o)return[2,st(u,t,r,s)];if(v.data.isNextGenBundlesProductPurchasingEnabled&&(t.assetType===i||t.assetType===l))return[2,st(d,t,r,s)]}return[3,4];case 3:return y.sent(),[3,4];case 4:return[2,st(p,t,r,s)]}}))}))}var ut=function(e){return(e=null==(e=null==(e=document.querySelector('.PurchaseButton[data-product-id="'+e.productId+'"]'))?void 0:e.closest(".store-card"))?void 0:e.querySelector(".gear-passes-asset img"))?e.src:null},dt=function(e,t,n){if(void 0===n&&(n=window.location.pathname),n.startsWith(r)){if(!t)throw new Error("button data not exist");if(Be(oe,t.assetType),!(n=ut(t)))throw Be(z,t.assetType),new Error("thumbnail image url process failed");return n}return e.imageurl};var pt=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},vt=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function yt(){var t=this;this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this._checkBalanceAndPurchase=function(n,r){return pt(t,void 0,Promise,(function(){var t,a=this;return vt(this,(function(o){switch(o.label){case 0:if(this._state.purchased)return[2,Promise.resolve()];o.label=1;case 1:return o.trys.push([1,5,,6]),t=this.translationResource.get(U,{}),this.loadingOverlay.updateMessage(t),[4,function(){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var t,n;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(r){switch(r.label){case 0:t=e.CurrentUser.userId,t={url:""+e.EnvironmentUrls.economyApi+"/v1/users/{userId}/currency".replace("{userId}",t),withCredentials:!0,retryable:!1,noCache:!0},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Le.httpService.get(t)];case 2:return 200===(n=r.sent()).status?[2,n.data.robux]:[2,Promise.reject()];case 3:return n=r.sent(),[2,Promise.reject(n)];case 4:return[2]}}))}))}()];case 2:return t=o.sent(),(n.userBalance=t)>=n.expectedPrice?[4,ct(n,r,this.loadingOverlay,this.translationResource)]:[3,4];case 3:o.sent(),this._stopPeriodicChecking(),this._state.purchased=!0,o.label=4;case 4:return this._state.purchased||(0<this._state.retryRemainTimes?(this._state.timeoutHandle=setTimeout((function(){return pt(a,void 0,void 0,(function(){return vt(this,(function(e){switch(e.label){case 0:return[4,this._checkBalanceAndPurchase(n,r)];case 1:return e.sent(),[2]}}))}))}),5e3),--this._state.retryRemainTimes):(Be(me,null==n?void 0:n.assetType),this._processGenericErrorState(n))),[3,6];case 5:return o.sent(),Be(he,null==n?void 0:n.assetType),this._processGenericErrorState(n),[3,6];case 6:return[2,Promise.resolve()]}}))}))},this._stopPeriodicChecking=function(){t._state.timeoutHandle&&(clearTimeout(t._state.timeoutHandle),t._state.timeoutHandle=null)},this._processGenericErrorState=function(e){t.loadingOverlay.hide(),ot(e,t.translationResource),Fe()},this.intl=new e.Intl,this.intlProvider=new e.TranslationResourceProvider(this.intl),this.translationResource=this.intlProvider.getTranslationResource("Purchasing.PurchaseDialog"),this.loadingOverlay=new je}var ht=(yt.prototype.startItemUpsellProcess=function(r,a,o,i){var l,s,c;return void 0===i&&(i=null===(l=document.getElementById(n))||void 0===l?void 0:l.dataset),pt(this,void 0,Promise,(function(){var n,l,u;return vt(this,(function(d){switch(d.label){case 0:if(!(n=i)||!ze(n)||!Qe(n))return o(r),[2,Promise.reject(r)];if(l=t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname),t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0,!ze(n)||!Array.isArray(l))return[3,6];d.label=1;case 1:return d.trys.push([1,5,,6]),[4,Me(Ke(n))];case 2:return d.sent()||qe(n)?[4,function(t,n){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:r=parseInt(t.userBalanceRobux,10),a={upsell_platform:"WEB",user_robux_balance:r,attempt_robux_amount:n.expectedItemPrice},r={url:e.EnvironmentUrls.apiGatewayUrl+"/payments-gateway/v1/products/get-upsell-product",withCredentials:!0},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Le.httpService.post(r,a)];case 2:return[2,o.sent()];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n,a)]:[3,4];case 3:if(200===(u=d.sent()).status)return t.paymentFlowAnalyticsService.startRobuxUpsellFlow(null!==(s=null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.assetType)&&void 0!==s?s:"",!(null===(s=a.buyButtonElementDataset)||void 0===s||!s.userassetId),null!==(s=null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.isPrivateServer)&&void 0!==s&&s,null!==(s=null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.isPlace)&&void 0!==s&&s),n.thumbnailImageUrl=dt(n,a.buyButtonElementDataset),p=r,h=a,E=n,b=u.data,w=this.intl,_=this.translationResource,S=this.intlProvider,P=Oe(p.shortfallPrice,!1),U=Oe(b.robux_amount),p=Oe(h.expectedItemPrice),w="<a class='text-link-secondary terms-of-use-link' target='_blank' href='"+Le.urlService.getUrlWithLocale("/info/terms",w.getRobloxLocale())+"'>",U="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+(null!==(E=E.thumbnailImageUrl)&&void 0!==E?E:"")+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,Le.escapeHtml)()(h.assetName)+"</div>\n          <div class='text-robux item-card-price'>"+p+"</div>\n        </div>\n      </div>"+_.get(f,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:P,robuxPackageAmount:U,lineBreak:"",aTagStart:w,aTagEnd:"</a>"}),Be(j,null===(w=h.buyButtonElementDataset)||void 0===w?void 0:w.assetType),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN),e.Dialog.open({titleText:_.get(m,{}),bodyContent:U,declineText:_.get(y,{}),acceptText:_.get(v,{}),acceptColor:"btn-primary-md",onAccept:function(){return t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.BUY_ROBUX_AND_ITEM),Ve(b,e.CurrentUser.isUnder13,(function(){return He(b,0,h.buyButtonElementDataset)}),S,h.buyButtonElementDataset).catch((function(){var e;Be(Ne,null===(e=h.buyButtonElementDataset)||void 0===e?void 0:e.assetType),He(b,0,h.buyButtonElementDataset)})),!1},onDecline:function(){var e;t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),Be(Y,null===(e=h.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},onCancel:function(){var e;t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),Be(Y,null===(e=h.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0}),[2,Promise.resolve()];204===u.status?Be(le,null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.assetType):Be(se,null===(c=a.buyButtonElementDataset)||void 0===c?void 0:c.assetType),d.label=4;case 4:return[3,6];case 5:return u=d.sent(),Be(ie,null===(c=a.buyButtonElementDataset)||void 0===c?void 0:c.assetType),o(r),[2,Promise.reject(u)];case 6:return o(r),[2,Promise.reject(r)]}var p,h,E,b,w,_,S,P,U}))}))},yt.prototype.showExceedLargestInsufficientRobuxModal=function(a,o,i,l){var s,c;return void 0===l&&(l=null===(s=document.getElementById(n))||void 0===s?void 0:s.dataset),pt(this,void 0,void 0,(function(){var n;return vt(this,(function(s){switch(s.label){case 0:if(Be(Q,null==o?void 0:o.assetType),null==(n=l)||!n.newUpsellInsufficientRobuxModalExperimentMetadata)return Be(re,null==o?void 0:o.assetType),i(),[2];if(null==n||!n.imageurl)return Be(ae,null==o?void 0:o.assetType),i(),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Me(n.newUpsellInsufficientRobuxModalExperimentMetadata)];case 2:return s.sent()?(t.paymentFlowAnalyticsService.startRobuxUpsellFlow(null!==(c=null==o?void 0:o.assetType)&&void 0!==c?c:"",!(null==o||!o.userassetId),null!==(c=null==o?void 0:o.isPrivateServer)&&void 0!==c&&c,null!==(c=null==o?void 0:o.isPlace)&&void 0!==c&&c),function(n,a,o,i){var l=Oe(n),s=Oe(parseInt(o.expectedPrice,10));n=a,window.location.pathname.startsWith(r)&&(n=null!==(a=ut(o))&&void 0!==a?a:n),l="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+n+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,Le.escapeHtml)()(o.itemName)+"</div>\n          <div class='text-robux item-card-price'>"+s+"</div>\n        </div>\n      </div>"+i.get(b,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:l}),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN),Be(J,o.assetType),e.Dialog.open({titleText:i.get(m,{}),bodyContent:l,declineText:i.get(y,{}),acceptText:i.get(E,{}),acceptColor:"btn-primary-md",onAccept:function(){return t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.GO_TO_ROBUX_STORE),Be($,null==o?void 0:o.assetType),window.location.href=e.Endpoints.getAbsoluteUrl("/upgrades/robux?ctx=upsell"),!1},onDecline:function(){t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),Be(Z,null==o?void 0:o.assetType)},onCancel:function(){t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),Be(Y,null==o?void 0:o.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}(a,n.imageurl,o,this.translationResource),Be(ee,null==o?void 0:o.assetType),[2]):(Be(te,null==o?void 0:o.assetType),[3,4]);case 3:return s.sent(),Be(ne,null==o?void 0:o.assetType),[3,4];case 4:return i(),[2]}}))}))},yt.prototype.initiateAutoPurchase=function(a,o,i,l){var s;return void 0===i&&(i=document.getElementById(n)),void 0===l&&(l=document.getElementById("item-container")),pt(this,void 0,Promise,(function(){var n,c,u,d;return vt(this,(function(p){switch(p.label){case 0:return this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this.loadingOverlay.show(),Be(ce,H),function(n){n&&(n.startsWith("/catalog/")||n.startsWith("/bundles/")||n.startsWith("/game-pass/")||n.startsWith(r))&&!n.includes("UpsellUuid=")||(t.upsellUtil.expireUpsellCookie(),window.location.href=e.Endpoints.getAbsoluteUrl("/catalog"))}(a),[4,function(t,n,r,a){return $e(this,void 0,Promise,(function(){var o,i,l,s,c,u,d,p;return et(this,(function(v){switch(v.label){case 0:return[4,rt(a,r,n)];case 1:return u=v.sent(),p=u[0],o=u[1],i=o.placeproductpromotionId,d=e.MetaDataValues&&e.MetaDataValues.getPageName()||"",l="LibraryItem"===d,s=parseInt(p.userBalanceRobux,10),c=parseInt(o.expectedCurrency,10),u=parseInt(o.expectedPrice,10),d=parseInt(o.expectedSellerId,10),p={itemContainerElemClassList:null==t?void 0:t.classList,assetType:o.assetType,assetName:(0,Le.escapeHtml)()(o.itemName),expectedSellerId:d,expectedCurrency:c,expectedPrice:u,productId:o.productId,isLibrary:l,itemThumbnailUrl:p.imageurl,itemPath:a,alertImageUrl:p.alerturl,userBalance:s,itemPurchaseAjaxData:p,itemDetail:o},i&&(p.expectedPromoId=parseInt(i,10)),o.userassetId&&(p.userAssetId=parseInt(o.userassetId,10)),[2,p]}}))}))}(l,null==l?void 0:l.dataset,null==i?void 0:i.dataset,a)];case 1:n=p.sent(),d=this.translationResource.get(P,{}),c=n.userBalance,u=n.expectedPrice,p.label=2;case 2:return p.trys.push([2,7,,8]),[4,Me(Ke(n.itemPurchaseAjaxData))];case 3:return p.sent()||qe(n.itemPurchaseAjaxData)?(a.startsWith(r)&&null!==(s=document.getElementById("tab-store"))&&void 0!==s&&s.click(),u<c?(this.loadingOverlay.updateMessage(d),[4,ct(n,o,this.loadingOverlay,this.translationResource)]):[3,5]):(Be(fe,null==n?void 0:n.assetType),[2,Ye(a)]);case 4:return p.sent(),this._state.purchased=!0,[2,Promise.resolve()];case 5:return[4,this._checkBalanceAndPurchase(n,o)];case 6:return p.sent(),[3,8];case 7:return d=p.sent(),Be(he,null==n?void 0:n.assetType),Ze(V.UPSELL_FAILED,{itemPurchaseObj:n,error:d}),Fe(),[3,8];case 8:return[2,Promise.resolve()]}}))}))},yt);void 0===window.Roblox&&(window.Roblox={}),void 0===window.Roblox.ItemPurchaseUpsellService&&(window.Roblox.ItemPurchaseUpsellService=new ht)}(),window.Roblox&&window.Roblox.BundleDetector&&window.Roblox.BundleDetector.bundleDetected("ItemPurchaseUpsell");